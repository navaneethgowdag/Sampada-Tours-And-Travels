<!DOCTYPE html>
<html lang="en">
<head>
  <title>Feedback | Sampada Tours & Travels</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>

<header class="main-header">
  <div class="logo"><a href="index.html">Sampada Tours & Travels</a></div>
  <nav class="main-nav">
    <a href="index.html">Home</a>
    <a href="tours.html">Tours</a>
    <a href="car-rentals.html">Car Rentals</a>
    <a href="contact.html" class="active">Contact</a>
  </nav>
  <div class="auth-links" id="authLinks">
    <a href="login.html" class="btn-secondary">Login</a>
    <a href="register.html" class="btn-primary">Sign Up</a>
  </div>
</header>

<main class="container section">
  <h2><i class="far fa-comment-dots"></i> Send Us Your Feedback</h2>
  <p class="section-description">Your feedback helps us improve our services.</p>

  <div id="alertBox" class="alert-box" style="display:none;"></div>

  <form id="feedbackForm" class="feedback-form">
    <fieldset>
      <legend>Contact Information</legend>
      <div class="form-group">
        <label for="name">Full Name *</label>
        <input type="text" id="name" required>
      </div>
      <div class="form-group">
        <label for="phone">Phone *</label>
        <input type="tel" id="phone" pattern="[0-9]{10}" maxlength="10" required>
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email">
      </div>
    </fieldset>

    <fieldset>
      <legend>Feedback Details</legend>
      <div class="form-group">
        <label for="serviceType">Service Type *</label>
        <select id="serviceType" required>
          <option value="">Select Service</option>
          <option value="Tour Package">Tour Package</option>
          <option value="Car Rental">Car Rental</option>
          <option value="Custom Trip">Custom Trip</option>
          <option value="General Inquiry">General Inquiry</option>
        </select>
      </div>
      <div class="form-group">
        <label for="message">Your Message *</label>
        <textarea id="message" rows="4" placeholder="Tell us about your experience..." required></textarea>
      </div>
    </fieldset>

    <button type="submit" class="btn-submit" id="submitBtn">
      <i class="fas fa-paper-plane"></i> Submit Feedback
    </button>
  </form>
</main>

<footer class="main-footer">
  <div class="footer-content">
    <p>Sampada Tours & Travels</p>
    <p class="copyright">Â© 2025 Sampada Tours & Travels</p>
  </div>
</footer>

<script>
const API = 'https://sampada-tours-and-travels-ood6.onrender.com';


const form = document.getElementById('feedbackForm');
const alertBox = document.getElementById('alertBox');

// Phone number formatting
document.getElementById('phone').addEventListener('input', e => {
  e.target.value = e.target.value.replace(/\D/g, '');
});

// Submit feedback
form.addEventListener('submit', async e => {
  e.preventDefault();
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';

  const data = {
    service_type: document.getElementById('serviceType').value,
    message: document.getElementById('message').value,
    phone: document.getElementById('phone').value,
    email: document.getElementById('email').value || null,
    name: document.getElementById('name').value
  };

  try {
    const token = localStorage.getItem('authToken');
    const res = await fetch(`${API}/feedback`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': token ? `Bearer ${token}` : ''
      },
      body: JSON.stringify(data)
    });

    const result = await res.json();

    if (res.ok) {
      alertBox.textContent = result.message || 'Thank you for your feedback!';
      alertBox.className = 'alert-box success';
      alertBox.style.display = 'block';
      form.reset();
    } else {
      throw new Error(result.message);
    }
  } catch (err) {
    alertBox.textContent = err.message || 'Failed to submit. Please try again.';
    alertBox.className = 'alert-box error';
    alertBox.style.display = 'block';
  } finally {
    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Feedback';
  }
});

// Auth UI
const token = localStorage.getItem('authToken');
const username = localStorage.getItem('username');
if (token && username) {
  document.getElementById('authLinks').innerHTML = `
    <span style="font-weight:600;margin-right:10px;">
      <i class="fas fa-user-circle"></i> ${username}
    </span>
    <button onclick="localStorage.clear();location.href='index.html'" class="btn-secondary">Logout</button>
  `;
  // Pre-fill name if logged in
  document.getElementById('name').value = username;
}
</script>
</body>
</html>